import numpy as np
from numba import njit

@njit
def wspolczynnik_sd(wsp_sigma, w, exposure):
    n, m = w.shape
    sd_j = np.empty(m)

    for j in range(m):
        denominator = 0.0
        for i in range(n):
            wij = w[i, j]
            ei = exposure[i]
            if not np.isnan(wij) and not np.isnan(ei):
                denominator += wij * ei

        if denominator == 0:
            sd_j[j] = 0.0  # lub np.nan
        else:
            sd_j[j] = np.sqrt(wsp_sigma[j] / denominator)

    return sd_j


