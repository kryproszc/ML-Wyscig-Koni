array([[      0.  ,       0.  ,       0.  ,       0.  ,       0.  ,
              0.  ,       0.  ,       0.  ,       0.  ,       0.  ,
              0.  ,       0.  ,       0.  ,       0.  ,       0.  ,
              0.  ,       0.  ,       0.  ,       0.  ,       0.  ],
       [  81456.56,   98178.25,  125418.28,  125418.28,  125418.28,
         125418.28,  125418.28,  125418.28,  125418.28,  125418.28,
         125418.28,  125418.28,  125418.28,  125418.28,  125418.28,
         125418.28,  125418.28,  125418.28,  125418.28,        nan],
       [ 182435.68,  213046.89,  213127.21,  214091.29,  214091.29,
         214101.57,  214101.57,  214101.57,  214101.57,  214101.57,
         214101.57,  214101.57,  214101.57,  214101.57,  214101.57,
         214101.57,  214101.57,  214101.57,        nan,        nan],
       [  54139.48,  152534.81,  152920.05,  152920.05,  152920.05,
         152920.05,  152920.05,  152920.05,  152920.05,  152920.05,
         152920.05,  152920.05,  152920.05,  152920.05,  152920.05,
         152920.05,  152920.05,        nan,        nan,        nan],
       [ 180345.53,  251714.57,  251926.83,  251926.83,  251926.83,
         251926.83,  251926.83,  251926.83,  251926.83,  251926.83,
         251926.83,  251926.83,  251926.83,  251926.83,  251926.83,
         251926.83,        nan,        nan,        nan,        nan],
       [  67569.03,   82194.49,   87723.9 ,   90881.84,   91124.05,
          91124.05,   91124.05,   91124.05,   91124.05,   91124.05,
          91124.05,   91124.05,   91124.05,   91124.05,   91124.05,
               nan,        nan,        nan,        nan,        nan],
       [  21603.67,   35739.8 ,   35772.84,   35772.84,   35772.84,
          35772.84,   35772.84,   35772.84,   35772.84,   35772.84,
          35772.84,   35772.84,   35772.84,   35772.84,        nan,
               nan,        nan,        nan,        nan,        nan],
       [  77473.8 ,  175342.09,  177174.54,  177423.04,  177445.63,
         177445.63,  177445.63,  177445.63,  177445.63,  177445.63,
         177445.63,  177445.63,  177445.63,        nan,        nan,
               nan,        nan,        nan,        nan,        nan],
       [ 149490.37,  389039.2 ,  394590.85,  401061.01,  410163.35,
         410172.85,  410172.85,  410172.85,  410172.85,  410172.85,
         410172.85,  410172.85,        nan,        nan,        nan,
               nan,        nan,        nan,        nan,        nan],
       [ 255042.71,  773258.37,  914060.92,  921260.49,  919131.7 ,
         919136.89,  919548.44,  920499.41,  920499.41,  920499.41,
         920499.41,        nan,        nan,        nan,        nan,
               nan,        nan,        nan,        nan,        nan],
       [ 506122.13, 1511368.54, 1691803.61, 1726592.56, 1726740.2 ,
        1726839.18, 1726875.35, 1726875.35, 1726875.35, 1726875.35,
               nan,        nan,        nan,        nan,        nan,
               nan,        nan,        nan,        nan,        nan],
       [ 542003.  , 1199515.37, 1288037.85, 1289922.34, 1290217.29,
        1291214.19, 1291214.19, 1291214.19, 1291214.19,        nan,
               nan,        nan,        nan,        nan,        nan,
               nan,        nan,        nan,        nan,        nan],
       [ 665779.37, 1425270.71, 1496171.96, 1505202.4 , 1517890.17,
        1522519.03, 1523625.57, 1523625.57,        nan,        nan,
               nan,        nan,        nan,        nan,        nan,
               nan,        nan,        nan,        nan,        nan],
       [ 452654.23,  786006.21,  844952.7 ,  878594.65,  873521.31,
         878823.62,  878823.62,        nan,        nan,        nan,
               nan,        nan,        nan,        nan,        nan,
               nan,        nan,        nan,        nan,        nan],
       [ 315063.85,  584403.71,  589913.92,  595511.9 ,  595513.09,
         595513.09,        nan,        nan,        nan,        nan,
               nan,        nan,        nan,        nan,        nan,
               nan,        nan,        nan,        nan,        nan],
       [ 161107.37,  351484.55,  369946.1 ,  369990.16,  369990.16,
               nan,        nan,        nan,        nan,        nan,
               nan,        nan,        nan,        nan,        nan,
               nan,        nan,        nan,        nan,        nan],
       [ 167502.59,  283476.47,  301851.5 ,  301851.5 ,        nan,
               nan,        nan,        nan,        nan,        nan,
               nan,        nan,        nan,        nan,        nan,
               nan,        nan,        nan,        nan,        nan],
       [  74875.82,  111576.28,  111616.46,        nan,        nan,
               nan,        nan,        nan,        nan,        nan,
               nan,        nan,        nan,        nan,        nan,
               nan,        nan,        nan,        nan,        nan],
       [  20143.13,   22238.29,        nan,        nan,        nan,
               nan,        nan,        nan,        nan,        nan,
               nan,        nan,        nan,        nan,        nan,
               nan,        nan,        nan,        nan,        nan],
       [   6832.15,        nan,        nan,        nan,        nan,
               nan,        nan,        nan,        nan,        nan,
               nan,        nan,        nan,        nan,        nan,
               nan,        nan,        nan,        nan,        nan]])




inf
array([[      0.        ,       0.        ,       0.        ,
              0.        ,       0.        ,       0.        ,
              0.        ,       0.        ,       0.        ,
              0.        ,       0.        ,       0.        ,
              0.        ,       0.        ,       0.        ,
              0.        ,       0.        ,       0.        ,
              0.        ,       0.        ],
       [  45847.92832679,   55450.13955254,   71627.61363554,
          71627.61363554,   71627.61363554,   71627.61363554,
          71627.61363554,   71627.61363554,   71627.61363554,
          71627.61363554,   71627.61363554,   71627.61363554,
          71627.61363554,   71627.61363554,   71627.61363554,
          71627.61363554,   71627.61363554,   71627.61363554,
          71627.61363554,              nan],
       [ 104761.29712216,  122940.86801192,  122990.73845688,
         123607.39953437,  123607.39953437,  123614.19773663,
         123614.19773663,  123614.19773663,  123614.19773663,
         123614.19773663,  123614.19773663,  123614.19773663,
         123614.19773663,  123614.19773663,  123614.19773663,
         123614.19773663,  123614.19773663,  123614.19773663,
                     nan,              nan],
       [  32152.68245178,   93246.04512106,   93492.45881442,
          93492.45881442,   93492.45881442,   93492.45881442,
          93492.45881442,   93492.45881442,   93492.45881442,
          93492.45881442,   93492.45881442,   93492.45881442,
          93492.45881442,   93492.45881442,   93492.45881442,
          93492.45881442,   93492.45881442,              nan,
                     nan,              nan],
       [ 111975.99388177,  157626.26056681,  157763.84575776,
         157763.84575776,  157763.84575776,  157763.84575776,
         157763.84575776,  157763.84575776,  157763.84575776,
         157763.84575776,  157763.84575776,  157763.84575776,
         157763.84575776,  157763.84575776,  157763.84575776,
         157763.84575776,              nan,              nan,
                     nan,              nan],
       [  43219.64032512,   52699.74353211,   56356.36294675,
          58505.65417707,   58672.54672292,   58672.54672292,
          58672.54672292,   58672.54672292,   58672.54672292,
          58672.54672292,   58672.54672292,   58672.54672292,
          58672.54672292,   58672.54672292,   58672.54672292,
                     nan,              nan,              nan,
                     nan,              nan],
       [  14003.32169037,   23351.59707706,   23374.08407246,
          23374.08407246,   23374.08407246,   23374.08407246,
          23374.08407246,   23374.08407246,   23374.08407246,
          23374.08407246,   23374.08407246,   23374.08407246,
          23374.08407246,   23374.08407246,              nan,
                     nan,              nan,              nan,
                     nan,              nan],
       [  51233.712314  ,  117842.78576817,  119105.41838297,
         119279.7717315 ,  119296.35868969,  119296.35868969,
         119296.35868969,  119296.35868969,  119296.35868969,
         119296.35868969,  119296.35868969,  119296.35868969,
         119296.35868969,              nan,              nan,
                     nan,              nan,              nan,
                     nan,              nan],
       [ 101743.01641544,  266801.9078416 ,  270697.07390738,
         275447.8606918 ,  282505.20586063,  282513.0541687 ,
         282513.0541687 ,  282513.0541687 ,  282513.0541687 ,
         282513.0541687 ,  282513.0541687 ,  282513.0541687 ,
                     nan,              nan,              nan,
                     nan,              nan,              nan,
                     nan,              nan],
       [ 175734.80521246,  539326.90010111,  642712.7350344 ,
         648294.79970757,  646536.12605137,  646540.68087113,
         646914.58826958,  647812.5386673 ,  647812.5386673 ,
         647812.5386673 ,  647812.5386673 ,              nan,
                     nan,              nan,              nan,
                     nan,              nan,              nan,
                     nan,              nan],
       [ 355106.99448219, 1093220.32702869, 1233117.6028448 ,
        1261858.06568609, 1261987.63670526, 1262077.56345608,
        1262111.71686353, 1262111.71686353, 1262111.71686353,
        1262111.71686353,              nan,              nan,
                     nan,              nan,              nan,
                     nan,              nan,              nan,
                     nan,              nan],
       [ 397971.71778032,  907762.79874032,  980894.55600975,
         982548.41194261,  982816.38421128,  983757.70386541,
         983757.70386541,  983757.70386541,  983757.70386541,
                     nan,              nan,              nan,
                     nan,              nan,              nan,
                     nan,              nan,              nan,
                     nan,              nan],
       [ 516200.75940649, 1143645.18171729, 1205869.15369866,
        1214073.62053682, 1226054.00700291, 1230565.51496913,
        1231666.88193898, 1231666.88193898,              nan,
                     nan,              nan,              nan,
                     nan,              nan,              nan,
                     nan,              nan,              nan,
                     nan,              nan],
       [ 373954.72060141,  666509.2843567 ,  720064.20775258,
         751830.51203401,  746885.79263758,  752163.31455081,
         752163.31455081,              nan,              nan,
                     nan,              nan,              nan,
                     nan,              nan,              nan,
                     nan,              nan,              nan,
                     nan,              nan],
       [ 276504.63390622,  521209.20528539,  526412.20355138,
         531868.26214135,  531869.44657814,  531869.44657814,
                     nan,              nan,              nan,
                     nan,              nan,              nan,
                     nan,              nan,              nan,
                     nan,              nan,              nan,
                     nan,              nan],
       [ 146371.61362553,  326134.66030149,  344128.16839934,
         344172.0224206 ,  344172.0224206 ,              nan,
                     nan,              nan,              nan,
                     nan,              nan,              nan,
                     nan,              nan,              nan,
                     nan,              nan,              nan,
                     nan,              nan],
       [ 158163.78782643,  271197.46858015,  289486.59605123,
         289486.59605123,              nan,              nan,
                     nan,              nan,              nan,
                     nan,              nan,              nan,
                     nan,              nan,              nan,
                     nan,              nan,              nan,
                     nan,              nan],
       [  72977.54920378,  109506.43602395,  109546.61602395,
                     nan,              nan,              nan,
                     nan,              nan,              nan,
                     nan,              nan,              nan,
                     nan,              nan,              nan,
                     nan,              nan,              nan,
                     nan,              nan],
       [  20048.96167443,   22144.12167443,              nan,
                     nan,              nan,              nan,
                     nan,              nan,              nan,
                     nan,              nan,              nan,
                     nan,              nan,              nan,
                     nan,              nan,              nan,
                     nan,              nan],
       [   6832.15      ,              nan,              nan,
                     nan,              nan,              nan,
                     nan,              nan,              nan,
                     nan,              nan,              nan,
                     nan,              nan,              nan,
                     nan,              nan,              nan,
                     nan,              nan]])


@njit
def choose_value_list(vec_input, vec_wykluczenia, a, b):
    count = 0
    for k in range(len(vec_wykluczenia)):
        idx = vec_wykluczenia[k] - 1
        val = vec_input[idx]
        if a < val < b:
            count += 1

    out_vals = np.empty(count)
    out_inds = np.empty(count, dtype=np.int64)

    pos = 0
    for k in range(len(vec_wykluczenia)):
        idx = vec_wykluczenia[k] - 1
        val = vec_input[idx]
        if a < val < b:
            out_vals[pos] = val
            out_inds[pos] = idx
            pos += 1

    return out_vals, out_inds


@njit(fastmath=False)
def fit_curve_factor_lr(data_input, sd_input, x_k):

    n = len(data_input)
    se2 = sd_input**2
    w = np.empty(n)
    for i in range(n):
        denom = data_input[i] ** 2

        w_mian = np.sqrt(np.log(1.0 + se2[i] / denom))
        #w[i] = 1.0 / w_mian
        if  w_mian!=0 :
            w[i] = 1.0 / w_mian
        else:
            w[i] = 0

    y = np.empty(n)
    for i in range(n):
        if data_input[i] > 0.0:
            y[i] = np.log(data_input[i])
        else:
            y[i] = 0.0

    A = A_x = A_xx = A_y = A_xy = 0.0
    for i in range(n):
        wi = w[i]
        xi = x_k[i]
        yi = y[i]
        A += wi
        A_x += wi * xi
        A_xx += wi * xi * xi
        A_y += wi * yi
        A_xy += wi * xi * yi

    Delta = A * A_xx - A_x * A_x
    if Delta == 0.0:
        return 0.0, 0.0

    a_coef = (A * A_xy - A_x * A_y) / Delta
    b_coef = (A_xx * A_y - A_x * A_xy) / Delta
    return a_coef, b_coef
@njit
def wspolczynnik_reg_factor_cl(a_coef, b_coef, k_start, k_stop):
    n = k_stop - k_start + 1
    out = np.empty(n)
    for i in range(n):
        k = k_start + i
        out[i] = np.exp(a_coef * k + b_coef)
    return out

@njit
def _build_base_triangle(data_paid, n_dev):

    mm, n_cols_orig = data_paid.shape
    total_cols = n_dev + 1
    base = np.empty((mm, total_cols), dtype=np.float64)

    for i in range(mm):
        for j in range(total_cols):
            if j < n_cols_orig:
                base[i, j] = data_paid[i, j]
            else:
                base[i, j] = np.nan
    return base

def triangle_forward_loss_ratio_numba_disc(self,
        tri_in: np.ndarray,
        LR_j: np.ndarray,
        exposure: np.ndarray,
        discount_factors: np.ndarray,
        net_to_gross: float,
        k_forward: int
    ) -> np.ndarray:
        mm, n_cols_orig = tri_in.shape
        n_cols_out = max(n_cols_orig, len(LR_j) + 1)
        base_col = tri_in[:, 0].copy()
        tri = np.empty((mm, n_cols_out), dtype=np.float64)
        tri[:] = np.nan



@njit
def triangle_forward_loss_ratio_numba(
        tri_in: np.ndarray,
        LR_j:   np.ndarray,
        exposure: np.ndarray,
        k_forward: int
) -> np.ndarray:

    mm, n_cols_orig = tri_in.shape
    n_cols_out = max(n_cols_orig, len(LR_j) + 1)

    tri = np.empty((mm, n_cols_out), dtype=np.float64)
    tri[:] = np.nan

    for i in range(mm):
        for j in range(n_cols_orig):
            tri[i, j] = tri_in[i, j]

    for j in range(k_forward):
        max_ind_row = 1 if (mm - j) < 1 else (mm - j)
        start_row = max_ind_row - 1

        for i in range(start_row, mm):
            base_val = tri[i, j]
            tri[i, j + 1] = base_val + exposure[i] * LR_j[j]
    return tri

@njit
def sum_reverse_diagonal(data: np.ndarray) -> float:
    tot = 0.0
    rows, cols = data.shape
    for i in range(rows):
        j = cols - 1 - i
        if 0 <= j < cols:
            v = data[i, j]
            if not np.isnan(v):
                tot += v
    return tot


@njit
def vector_reverse_diagonal(data: np.ndarray):
    """Zwraca wektor elementów odwrotnej przekątnej (ostatniej pełnej diagonali)."""
    rows, cols = data.shape
    result = []
    for i in range(rows):
        j = cols - 1 - i
        if 0 <= j < cols:
            v = data[i, j]
            if not np.isnan(v):
                result.append(v)
    return np.array(result)

@njit
def vector_reverse_diagonal(data: np.ndarray):
    """Zwraca wektor elementów odwrotnej przekątnej (ostatniej pełnej diagonali)."""
    rows, cols = data.shape
    result = []
    for i in range(rows):
        j = cols - 1 - i
        if 0 <= j < cols:
            v = data[i, j]
            if not np.isnan(v):
                result.append(v)
    return np.array(result)

import pandas as pd

def pobierz_wartosci_z_excela(
    plik: str,
    arkusz: str,
    row_start: int,
    row_end: int,
    linia_biznesowa: str,
    wartosci: list
) -> dict:

    try:
        # Wczytaj cały arkusz bez nagłówka
        df = pd.read_excel(plik, sheet_name=arkusz, header=None)

        # Przesunięcie w lewo: ignorujemy pierwszą kolumnę (A)
        df = df.iloc[:, 1:]

        # Pobierz nagłówki z wiersza powyżej (np. wiersz 94 jeśli dane od 95)
        naglowki = df.iloc[row_start - 1]
        blok = df.iloc[row_start:row_end].copy()
        blok.columns = naglowki
        blok.reset_index(drop=True, inplace=True)

        # Załóżmy, że pierwsza kolumna to nazwy parametrów
        param_col = blok.columns[0]

        wynik = {}
        for parametr in wartosci:
            try:
                wartosc = blok.loc[blok[param_col] == parametr, linia_biznesowa].values[0]
                wynik[parametr] = wartosc
            except IndexError:
                wynik[parametr] = None  # brak takiego parametru
        return wynik

    except Exception as e:
        raise RuntimeError(f"Błąd przy pobieraniu danych: {e}")


@njit()
def transform_data(data_input, exposure):
    n, m = data_input.shape
    data_input = data_input[:,:(n+1)]

    output = np.empty((n, m))

    for i in range(n):
        output[i, 0] = data_input[i, 0]/exposure[i]

    for j in range(1, m):
        for i in range(n):
            if not np.isnan(data_input[i, j]):
                output[i, j] = (data_input[i, j] - data_input[i, j - 1]) / exposure[i]

    return output

@njit()
def wspolczynnik_LR(data_LR, w, exposure):
    n, m = data_LR.shape
    wsp_LR = np.empty(m)

    for j in range(m):
        numerator = 0.0
        denominator = 0.0

        for i in range(n):
            lr_ij = data_LR[i, j]
            w_ij = w[i, j]
            e_i = exposure[i]

            if not np.isnan(lr_ij) and not np.isnan(w_ij) and not np.isnan(e_i):
                numerator += lr_ij * w_ij * e_i
                denominator += w_ij * e_i

        if denominator == 0:
            wsp_LR[j] = 0.0  # lub np.nan jeśli wolisz
        else:
            wsp_LR[j] = numerator / denominator

    return wsp_LR



def triangle_forward_loss_ratio_numba_disc(
            tri_in: np.ndarray,
            LR_j: np.ndarray,
            exposure: np.ndarray,
            discount_factors: np.ndarray,
            net_to_gross: float,
            k_forward: int
    ) -> np.ndarray:
        mm, n_cols_orig = tri_in.shape
        n_cols_out = max(n_cols_orig, len(LR_j) + 1)
        base_col = tri_in[:, 0].copy()
        tri = np.empty((mm, n_cols_out), dtype=np.float64)
        tri[:] = np.nan
    
        for i in range(mm):
            for j in range(n_cols_orig):
                tri[i, j] = tri_in[i, j]
    
        for j in range(k_forward):
            max_ind_row = 1 if (mm - j) < 1 else (mm - j)
            start_row = max_ind_row - 1
    
            for i in range(start_row, mm):
                base_val = tri[i, j]
                tri[i, j + 1] = base_val + exposure[i] * LR_j[j]
    
                cols_tmp = tri.shape[1]
                tri_proj = np.full((mm, cols_tmp + 1), np.nan)
                tri_proj[:, 0] = base_col
                tri_proj[:, 1:] = tri
    
                inc_proj = tri_proj[:, 1:] - tri_proj[:, :-1]
                inc_proj[:, 0] = base_col
    
                for rr in range(mm - 1, -1, -1):
                    offset = mm - 1 - rr
                    for cc in range(offset + 1, inc_proj.shape[1]):
                        idx = cc - (offset + 1)
                        if idx < len(discount_factors) and not np.isnan(inc_proj[rr, cc]):
                            inc_proj[rr, cc] /= discount_factors[idx]
    
                total_disc = np.sum(np.nansum(inc_proj, axis=1))
        
        ult_gross_disc = np.nansum(inc_proj, axis=1)
       # total_disc = np.sum(np.nansum(inc_proj, axis=1))
       # ult_net_disc = latest + (total_disc - latest) * net_to_gross
        latest = vector_reverse_diagonal(tri_in)
        ult_net_disc = 0
        for iii in range(len(latest)):
            ult_net_disc += latest[iii] + (ult_gross_disc[iii] - latest[iii]) * net_to_gross[iii]
    
        return np.array([np.sum(tri[:,-1]),total_disc,ult_net_disc])

ult_det =  triangle_forward_loss_ratio_numba_disc(reserv_data,LR_j, np.array(exponsure),discount_factors, net_to_gross, len(LR_j))
ultimate_base = [ult_det[0], ult_det[1],ult_det[2]]
latest = vector_reverse_diagonal(np.array(reserv_data))
print(ultimate_base[0]-np.sum(latest))


@njit()
def sigma_LR(data_LR, w, exposure, wsp_LR):
    n, m = data_LR.shape
    sigma_j = np.empty(m)
    for j in range(m):
        sum_num = 0.0
        sum_denom = 0.0
        mean_j = wsp_LR[j]

        for i in range(n):
            lr = data_LR[i, j]
            wij = w[i, j]
            ei = exposure[i]
            if not np.isnan(wij):
                sum_num += wij * ei * (lr - mean_j) ** 2
                sum_denom += wij

        if sum_denom > 1:
            sigma_j[j] = sum_num / (sum_denom - 1)
        else:
            sigma_j[j] = 0
            #if sigma_j[j-1]!=0 and sigma_j[j-1]>0.000001:
           # if sigma_j[j-1]!=0:
           #     sigma_j[j] = sigma_j[j-2]**4/( sigma_j[j-1]**2)
            #else:
            #    sigma_j[j] = min(sigma_j[j-2]**2,sigma_j[j-1]**2)
            #else:
            #sigma_j[j] = sigma_j[j-1]

    return sigma_j

@njit()
def wspolczynnik_sd(wsp_sigma, w, exposure):
    n, m = w.shape
    sd_j = np.empty(m)
    for j in range(m):
        denominator = 0.0
        for i in range(n):
            wij = w[i, j]
            ei = exposure[i]
            if not np.isnan(wij):
                denominator += wij * ei
        if denominator == 0 or wsp_sigma[j]==0:
            sd_j[j] = 0
        else:
            sd_j[j] = np.sqrt(wsp_sigma[j] / denominator)

    return sd_j


@njit()
def simulate_reserving_batched_numba(data_paid,
                                     sigma_j, dev, sd, e_values, wagi_trimmed,
                                     ilosc_dop_wsp_CL,
                                     Poz_LR,
                                     il_ogon,
                                     ultimate_param_resrisk,discount_factors,net_to_gross,
                                     sim_total=100_000,
                                     batch_sim=10_000,
                                     main_seed=202260011):
    latest = vector_reverse_diagonal(data_paid)
    mm, _   = data_paid.shape
    n_dev   = len(dev)
    base    = _build_base_triangle(data_paid, n_dev)
    results = np.zeros((sim_total, 3))
    n_batches = (sim_total + batch_sim - 1) // batch_sim

    index_el = 0
    for batch_idx in range(n_batches):
        np.random.seed(main_seed + batch_idx)
        start   = batch_idx * batch_sim
        end     = min(start + batch_sim, sim_total)
        cur_bs  = end - start

        mu_part    = np.empty((cur_bs, n_dev), dtype=np.float64)
        sigma_part = np.empty((cur_bs, n_dev), dtype=np.float64)

        for jj in range(n_dev):

            mu_part[:, jj] = np.random.normal(dev[jj], sd[jj], cur_bs)
            df  = max(1, mm - jj)
            chi = np.random.chisquare(df, cur_bs)
            for ss in range(cur_bs):
                sigma_part[ss, jj] = (np.floor(chi[ss]) * sigma_j[jj]) / df

        for s in range(cur_bs):
            paid = base.copy()
            n_cols_target = n_dev + 1
            data_paid_to_one = data_paid.copy()
            new_tri = np.concatenate((data_paid_to_one, np.zeros((mm,1))), axis=1)
            empty_column = np.full((wagi_trimmed.shape[0], 1), np.nan)
            wagi_modified = np.hstack((wagi_trimmed, empty_column))
            LR_i_j = transform_data(new_tri, e_values)
            empty_column_lr = np.full((LR_i_j.shape[0], 1), np.nan)
            LR_i_j_stoch = np.hstack((LR_i_j, empty_column_lr))
            for j in range(n_dev):
                max_ind_row = mm - j
                if max_ind_row < 1:
                    max_ind_row = 1
                for i in range(max_ind_row - 1, mm):
                    var_ij = sigma_part[s, j] / e_values[i]
                    dev_con = dev[j]
                    std_con = sd[j]
                    if mu_part[s, j] > 0.0:
                        lmean  = np.log(mu_part[s, j]**2 /
                                        np.sqrt(mu_part[s, j]**2 + var_ij))
                        lstdev = np.sqrt(np.log(1.0 + var_ij /
                                                (mu_part[s, j]**2)))
                        sto_lr = np.random.lognormal(lmean, lstdev)
                        paid[i, j + 1] = e_values[i] * sto_lr + paid[i, j]
                        if j == mm - i - 1:
                            new_tri[i, j + 1] = e_values[i] * sto_lr + paid[i, j]
                            LR_i_j_stoch[i, j + 1] = sto_lr
                        if i == mm - j - 1 and (j < (mm)):
                            if dev_con - 2 * std_con <= sto_lr <= dev_con + 2 * std_con:
                                wagi_modified[i , j + 1] = 1
                            elif (dev_con - 3 * std_con <= sto_lr <= dev_con - 2 * std_con) or (
                                    dev_con + 2 * std_con <= sto_lr <= dev_con + 3 * std_con):
                                wagi_modified[i, j + 1] = 0.5
                            else:
                                wagi_modified[i , j + 1] = 0

                    else:
                        adj_mu = (mu_part[s, j] +
                                  paid[i, j] / e_values[i])
                        lmean  = np.log(adj_mu**2 /
                                        np.sqrt(adj_mu**2 + var_ij))
                        lstdev = np.sqrt(np.log(1.0 + var_ij / (adj_mu**2)))
                        sto_lr = np.random.lognormal(lmean, lstdev)
                        paid[i, j + 1] = (e_values[i] *
                                          (sto_lr - paid[i, j] / e_values[i]) +
                                          paid[i, j])
                        if j == mm - i - 1:
                            new_tri[i, j + 1] = (e_values[i] *
                                          (sto_lr - paid[i, j] / e_values[i]) +
                                          paid[i, j])
                            LR_i_j_stoch[i, j + 1] = sto_lr
                        if i == mm - j - 1 and (j < (mm)):
                            if dev_con - 2 * std_con <= sto_lr <= dev_con + 2 * std_con:
                                wagi_modified[i , j + 1] = 1
                            elif (dev_con - 3 * std_con <= sto_lr <= dev_con - 2 * std_con) or (
                                    dev_con + 2 * std_con <= sto_lr <= dev_con + 3 * std_con):
                                wagi_modified[i, j + 1] = 0.5
                            else:
                                wagi_modified[i , j + 1] = 0
         #   pd.DataFrame(wagi_modified).to_excel("wagi_modified.xlsx")

            new_tri[1:,new_tri.shape[1]-1] = np.nan
            
            LR_i_j_stoch = transform_data(new_tri, e_values)
            LR_j_wyzn = wspolczynnik_LR(LR_i_j_stoch, wagi_modified, e_values)
            sigma_j_pred = sigma_LR(LR_i_j_stoch, wagi_modified, e_values, LR_j_wyzn)
          #  pd.DataFrame(new_tri).to_excel("new_tri.xlsx")
            sd_j = wspolczynnik_sd(sigma_j_pred, wagi_modified, e_values)
            vector_value, x_k_ind = choose_value_list(LR_j_wyzn, ilosc_dop_wsp_CL, 0, 10)
            sd_input = sd_j[x_k_ind]
            x_k_ind = x_k_ind
            a, b = fit_curve_factor_lr(vector_value, sd_input, x_k_ind)
            total_f_len = len(LR_j_wyzn) + il_ogon + 1
            vec_f = np.empty(total_f_len - 2)
            vec_f[:(Poz_LR - 2)] = LR_j_wyzn[2:(Poz_LR)]
            tail_factors = wspolczynnik_reg_factor_cl(
                float(a), float(b),
                Poz_LR,
                total_f_len - 1,
            )
            vec_f[(Poz_LR - 2):] = tail_factors[:(total_f_len - 2)]
            
            tri_proj_tmp = triangle_forward_loss_ratio_numba(new_tri[:,1:],vec_f,e_values,len(vec_f))
            cols_tmp = tri_proj_tmp.shape[1]
            tri_proj = np.empty((mm, cols_tmp + 1))
            tri_proj[:, 0] = data_paid[:, 0]

            for r in range(mm):
                for c in range(cols_tmp):
                    tri_proj[r, c + 1] = tri_proj_tmp[r, c]
            inc_proj = tri_proj[:, 1:] - tri_proj[:, :-1]
            inc_disc = np.empty_like(tri_proj)
            inc_disc[:, 0] = tri_proj[:, 0]
            for r in range(mm):
                for c in range(1, tri_proj.shape[1]):
                    inc_disc[r, c] = inc_proj[r, c - 1]

            for rr in range(mm - 1, -1, -1):
                offset = mm - 1 - rr
                for cc in range(offset + 1, tri_proj.shape[1]):
                    idx = cc - (offset + 1)
                    if idx < len(discount_factors):
                        inc_disc[rr, cc] /= discount_factors[idx]

            cum_disc = inc_disc.copy()
            for r in range(mm):
                for c in range(1, tri_proj.shape[1]):
                    cum_disc[r, c] += cum_disc[r, c - 1]

            ult_gross = np.sum(paid[:,-1])

            #ult_gross_disc = np.sum(cum_disc[:, n_cols_target - 1])
            #ult_net_disc = latest + (ult_gross_disc - latest) * net_to_gross[

            ult_gross_disc = cum_disc[:, n_cols_target - 1]
           # total_disc = np.sum(np.nansum(inc_proj, axis=1))
           # ult_net_disc = latest + (total_disc - latest) * net_to_gross
            ult_gross_disc_sum = np.sum(ult_gross_disc)
            latest = vector_reverse_diagonal(data_paid)
            ult_net_disc = 0
            for iii in range(len(latest)):
                ult_net_disc += latest[iii] + (ult_gross_disc[iii] - latest[iii]) * net_to_gross[iii]

            results[index_el, 0] = ult_gross
            results[index_el, 1] = ult_gross_disc_sum
            results[index_el, 2] = ult_net_disc
            index_el = index_el+1
    return results


discc
array([ 1.03008058,  1.09909084,  1.17492201,  1.25624397,  1.34155878,
        1.4310109 ,  1.52499052,  1.62425078,  1.73035239,  1.84392912,
        1.96302684,  2.08515131,  2.20948369,  2.3360195 ,  2.46494711,
        2.59599928,  2.72926652,  2.86488688,  3.00271386,  3.14324522,
        3.28633796,  3.43219328,  3.58113814,  3.73281428,  3.88764134,
        4.04668905,  4.2092563 ,  4.37549711,  4.54620753,  4.72107744,
        4.90035716,  5.08509201,  5.2749506 ,  5.47030216,  5.67155883,
        5.8781861 ,  6.09155334,  6.31108484,  6.53717191,  6.77151942,
        7.01348492,  7.2621621 ,  7.5178696 ,  7.78256904,  8.05692428,
        8.33984846,  8.63181456,  8.9333347 ,  9.24496298,  9.56729849,
        9.90098871, 10.24673309, 10.60262589, 10.9718518 , 11.35231046,
       11.74444947, 12.15202843, 12.57261641, 13.01041545, 13.46276143,
       13.92627939, 14.40528546, 14.90495556, 15.42204773, 15.95247368,
       16.50155656, 17.0756527 , 17.66513129, 18.27021085, 18.90369484,
       19.5610468 , 20.23658172, 20.93060923, 21.65106592, 22.39936335,
       23.17700576, 23.97679705,  0.        ,  0.        ])

netto
[1.0,
 1.0,
 1.0,
 1.0,
 1.0,
 1.0,
 1.0,
 1.0,
 1.0,
 1.0,
 1.0,
 1.0,
 1.0,
 1.0,
 1.0,
 1.0,
 1.0,
 1.0,
 1.0,
 1.0]

-----

array([[8.953701281000000e+07, 1.073751815800000e+08,
        1.178629827300000e+08, 1.220637100900000e+08,
        1.241473594400000e+08, 1.267486052800000e+08,
        1.290816733600000e+08, 1.297092833200000e+08,
        1.304550917300000e+08, 1.308255623500000e+08,
        1.318975073400000e+08, 1.327465380100000e+08,
        1.343773186100000e+08, 1.367364395100000e+08,
        1.407053992800000e+08, 1.438925593000000e+08,
        1.452951474600000e+08, 1.460912854000000e+08,
        1.464450963100000e+08, 1.472618822700000e+08],
       [2.203008329000000e+07, 3.641645877000000e+07,
        4.062191363999999e+07, 4.390868128999999e+07,
        4.659243129999998e+07, 4.842671612999998e+07,
        5.099105234999998e+07, 5.257091361999999e+07,
        5.280467790999998e+07, 5.384930673999999e+07,
        5.422635880999999e+07, 5.437693715999999e+07,
        5.510479473000000e+07, 5.585200918999999e+07,
        5.640614203999999e+07, 5.704991516999999e+07,
        5.724736486999997e+07, 5.750562040999998e+07,
        5.763185592999996e+07,                   nan],
       [2.644058721000000e+07, 4.243680817000000e+07,
        4.710295314000000e+07, 5.378898800999999e+07,
        5.646065538000000e+07, 5.893916741000000e+07,
        6.005625317000001e+07, 6.317904397000001e+07,
        6.371489281000000e+07, 6.480802534999999e+07,
        6.683712044000000e+07, 6.817027136000001e+07,
        6.977897100000000e+07, 7.174120424000001e+07,
        7.290108756000003e+07, 7.361995091000001e+07,
        7.374467189000002e+07, 7.399009768000002e+07,
                          nan,                   nan],
       [2.566951537000000e+07, 4.458307926000000e+07,
        5.394398498000001e+07, 5.776289477000001e+07,
        6.065458320000001e+07, 6.116202890000002e+07,
        6.359000629000001e+07, 6.642076496000002e+07,
        6.726542536000003e+07, 6.819146226000002e+07,
        6.882295828000002e+07, 7.020626842000002e+07,
        7.083002720000002e+07, 7.148115454000002e+07,
        7.155987155000003e+07, 7.168212628000003e+07,
        7.177556624000004e+07,                   nan,
                          nan,                   nan],
       [2.251295082000000e+07, 4.034815036000000e+07,
        4.687912673000001e+07, 4.860304049000002e+07,
        4.990990778000002e+07, 5.107953398000003e+07,
        5.140075435000002e+07, 5.217530043000002e+07,
        5.243332302000003e+07, 5.312918122000002e+07,
        5.609845039000002e+07, 5.684955144000001e+07,
        5.732269731000000e+07, 5.818406257000001e+07,
        5.811042669000001e+07, 5.862219879000002e+07,
                          nan,                   nan,
                          nan,                   nan],
       [2.505186760000000e+07, 4.401511612000000e+07,
        5.057487232000000e+07, 5.695366498000002e+07,
        5.840688165000001e+07, 5.911014450000001e+07,
        6.019307137000002e+07, 6.244029056000001e+07,
        6.443646961000001e+07, 6.680728919000001e+07,
        6.799615354000001e+07, 6.925519890000001e+07,
        7.015108214000000e+07, 7.061078838000000e+07,
        7.084434525000000e+07,                   nan,
                          nan,                   nan,
                          nan,                   nan],
       [3.617234990000000e+07, 6.033274133999999e+07,
        6.638498564999999e+07, 6.988771858000000e+07,
        7.364617358000001e+07, 8.309131412999997e+07,
        8.486108998999999e+07, 8.645893399000001e+07,
        8.865475139999999e+07, 8.955354372000000e+07,
        9.119791396000001e+07, 9.144889361000001e+07,
        9.137303029000004e+07, 9.140088686000003e+07,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan],
       [5.246485931999999e+07, 8.011858524000001e+07,
        8.647578963000001e+07, 9.046441037000000e+07,
        9.320771927000001e+07, 9.502628570000000e+07,
        9.986691138000000e+07, 1.017998811900000e+08,
        1.021689477600000e+08, 1.034394979700000e+08,
        1.034694061900000e+08, 1.039574338600000e+08,
        1.044156799200000e+08,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan],
       [7.277638045999999e+07, 1.125022725300000e+08,
        1.285937323100000e+08, 1.309495022000000e+08,
        1.357957340000001e+08, 1.396649730000001e+08,
        1.431073407100001e+08, 1.446267584900001e+08,
        1.461209153400001e+08, 1.468011910200001e+08,
        1.474520033300001e+08, 1.480252153200001e+08,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan],
       [7.122032456000000e+07, 1.036237195500000e+08,
        1.161180919500000e+08, 1.234950431699999e+08,
        1.288214628800000e+08, 1.317829988200000e+08,
        1.329807860600000e+08, 1.362182398600000e+08,
        1.422170792900000e+08, 1.432264611499999e+08,
        1.439801352000000e+08,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan],
       [7.051329089999999e+07, 1.027383044600000e+08,
        1.122562014200000e+08, 1.170646112700000e+08,
        1.219156986000000e+08, 1.244328812200000e+08,
        1.256321931600000e+08, 1.273584933900000e+08,
        1.290735399400000e+08, 1.292165316200000e+08,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan],
       [7.061467529000001e+07, 1.084391132500000e+08,
        1.205096499000000e+08, 1.279533651000000e+08,
        1.332547469700000e+08, 1.365614597800000e+08,
        1.475765291800000e+08, 1.500571709000000e+08,
        1.505688515700000e+08,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan],
       [8.738246456000000e+07, 1.415454960900000e+08,
        1.605870457700000e+08, 1.714581889500000e+08,
        1.762059564200001e+08, 1.811530865200000e+08,
        1.834509607300000e+08, 1.845666957800001e+08,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan],
       [1.170491904100000e+08, 1.944233026600000e+08,
        2.137239714399999e+08, 2.255959267799999e+08,
        2.367894091800000e+08, 2.411270873199999e+08,
        2.451366795200000e+08,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan],
       [1.435332585200000e+08, 2.318664247200000e+08,
        2.523924638000000e+08, 2.700689407300000e+08,
        2.861046214800000e+08, 2.972986180100000e+08,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan],
       [1.722887891100000e+08, 2.753945950000000e+08,
        3.106870420500000e+08, 3.278922040300000e+08,
        3.423848932500000e+08,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan],
       [2.121914261300000e+08, 3.478107587500001e+08,
        3.864157487700000e+08, 4.129798619000000e+08,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan],
       [2.311114623000000e+08, 3.811768956000000e+08,
        4.241785828700000e+08,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan],
       [2.242377179200000e+08, 3.591966944899999e+08,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan],
       [3.065491531900000e+08,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan]])



inf
array([[4.810818787526463e+07, 5.814842383966170e+07,
        6.417090613278147e+07, 6.666565955251443e+07,
        6.795939112915713e+07, 6.962324377884038e+07,
        7.113551937135619e+07, 7.155056017400227e+07,
        7.205815673223813e+07, 7.231342606435369e+07,
        7.306552746653727e+07, 7.368893765834078e+07,
        7.495333577891542e+07, 7.690229447311442e+07,
        8.038551150417766e+07, 8.328115653277065e+07,
        8.460554594159172e+07, 8.538149999043341e+07,
        8.573365684860726e+07, 8.655044280860727e+07],
       [1.239966037987659e+07, 2.066084786343910e+07,
        2.315840888545818e+07, 2.519915297413736e+07,
        2.691577832978846e+07, 2.810474671091303e+07,
        2.980055179820524e+07, 3.087580401095802e+07,
        3.103687711894365e+07, 3.176981287136915e+07,
        3.204666753820776e+07, 3.216341591180212e+07,
        3.276472648439297e+07, 3.342049280195600e+07,
        3.392394164739005e+07, 3.453182237772189e+07,
        3.472426628280393e+07, 3.498131448850337e+07,
        3.510755000850335e+07,                   nan],
       [1.518316051328968e+07, 2.468309314942345e+07,
        2.758028844232698e+07, 3.185692260864019e+07,
        3.358867548358069e+07, 3.522772471456997e+07,
        3.598801231581904e+07, 3.813974224747350e+07,
        3.851570618935678e+07, 3.931835088819676e+07,
        4.089157540304766e+07, 4.199294162646308e+07,
        4.340475991352858e+07, 4.518751662818702e+07,
        4.628273276381750e+07, 4.698337130768140e+07,
        4.710750922209778e+07, 4.735293501209779e+07,
                          nan,                   nan],
       [1.524476733767250e+07, 2.698814192771192e+07,
        3.297572201189847e+07, 3.545110801325198e+07,
        3.736339233549191e+07, 3.770875943964080e+07,
        3.938173465893607e+07, 4.136786042547408e+07,
        4.198806169802980e+07, 4.270604872580212e+07,
        4.322775138993055e+07, 4.444176456167164e+07,
        4.500847097083030e+07, 4.562329589056286e+07,
        4.570001724694266e+07, 4.582170044097896e+07,
        4.591514040097897e+07,                   nan,
                          nan,                   nan],
       [1.397822304373726e+07, 2.538627358472669e+07,
        2.961959889756906e+07, 3.075962948383167e+07,
        3.164908223011408e+07, 3.245500227553860e+07,
        3.268037791789030e+07, 3.324909697287267e+07,
        3.344915041835872e+07, 3.402402510528962e+07,
        3.662989907280406e+07, 3.731230033529336e+07,
        3.775906681809001e+07, 3.859859452735683e+07,
        3.852530289214506e+07, 3.903707499214507e+07,
                          nan,                   nan,
                          nan,                   nan],
       [1.602409724018010e+07, 2.831591938521054e+07,
        3.265391057708187e+07, 3.699531133966663e+07,
        3.799663675858941e+07, 3.849006224266078e+07,
        3.928521331504298e+07, 4.102755665684830e+07,
        4.267667540895437e+07, 4.475734128041373e+07,
        4.583746563035112e+07, 4.702631520684357e+07,
        4.789948578751886e+07, 4.835704291926841e+07,
        4.859059978926841e+07,                   nan,
                          nan,                   nan,
                          nan,                   nan],
       [2.344662050226665e+07, 3.942397729166734e+07,
        4.354312952991915e+07, 4.595665504948734e+07,
        4.859367402146266e+07, 5.552887329039671e+07,
        5.690103903189648e+07, 5.822107818536831e+07,
        6.014815959784056e+07, 6.096474348343585e+07,
        6.251743485225262e+07, 6.276205160245346e+07,
        6.268654294043445e+07, 6.271439951043444e+07,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan],
       [3.469520675370955e+07, 5.351630867637303e+07,
        5.789668118406972e+07, 6.069518976363079e+07,
        6.270949476809581e+07, 6.411948945176579e+07,
        6.811851277625874e+07, 6.981491529805179e+07,
        7.015022503208905e+07, 7.134993802660014e+07,
        7.137908800581436e+07, 7.186483416601354e+07,
        7.232308022601354e+07,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan],
       [4.953154154209520e+07, 7.690429767699018e+07,
        8.819443810081799e+07, 8.992418828636764e+07,
        9.368163204047482e+07, 9.687815621563844e+07,
        9.989922836791530e+07, 1.012796719331596e+08,
        1.026905247862576e+08, 1.033535539445270e+08,
        1.040013237330574e+08, 1.045745357230573e+08,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan],
       [4.907370167028073e+07, 7.180867317986107e+07,
        8.098280477436341e+07, 8.670239897246638e+07,
        9.110275505542818e+07, 9.370184222740874e+07,
        9.479007333129229e+07, 9.784702878446507e+07,
        1.036937841144018e+08, 1.046984471546546e+08,
        1.054521212046546e+08,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan],
       [4.947375607256556e+07, 7.313532990512256e+07,
        8.051487012533808e+07, 8.448727873840639e+07,
        8.874466379298738e+07, 9.103161119880469e+07,
        9.216405768345824e+07, 9.384659231179775e+07,
        9.555362108790261e+07, 9.569661276790263e+07,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan],
       [5.184960899784872e+07, 8.117614640479150e+07,
        9.114807168749525e+07, 9.768078480668730e+07,
        1.024972734549537e+08, 1.056196265080245e+08,
        1.163554390723679e+08, 1.188244838917323e+08,
        1.193361645617323e+08,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan],
       [6.775051405495340e+07, 1.124966358855754e+08,
        1.292077778438656e+08, 1.390845871370148e+08,
        1.435676514691801e+08, 1.483893606710323e+08,
        1.506764924111820e+08, 1.517922274611820e+08,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan],
       [9.669874795247680e+07, 1.646033983320901e+08,
        1.821387229629904e+08, 1.933487790312613e+08,
        2.042584814239377e+08, 2.085758810924545e+08,
        2.125854732924546e+08,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan],
       [1.259668829046534e+08, 2.062206172517940e+08,
        2.256022643652272e+08, 2.428306027648400e+08,
        2.587913173499227e+08, 2.699853138799227e+08,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan],
       [1.565303193244358e+08, 2.538876485839943e+08,
        2.882853525572271e+08, 3.054100810944234e+08,
        3.199027703144234e+08,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan],
       [2.003610791989096e+08, 3.325421560707144e+08,
        3.709666693093671e+08, 3.975307824393671e+08,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan],
       [2.252522658390256e+08, 3.746161492518365e+08,
        4.176178365218366e+08,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan],
       [2.231894155744771e+08, 3.581483921444771e+08,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan],
       [3.065491531900000e+08,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan,
                          nan,                   nan]])


gross_net
[1.0,
 0.9604598547491539,
 0.9072182795434456,
 0.9991264255884769,
 0.9992275000443264,
 0.9600524690460047,
 0.9648694205514023,
 0.9963077346590807,
 0.9701319822895752,
 0.9632916732275056,
 1.0,
 0.9955962739665414,
 0.9264367505945098,
 0.6865577471927192,
 0.6686950463879244,
 0.7487799964566464,
 0.7861905609173263,
 0.8690588341944445,
 0.8492159987286978,
 0.7675766299391751]

inf
[0.0,
 0.008,
 0.035,
 0.021,
 0.01,
 0.025,
 0.042,
 0.035,
 0.026,
 0.043,
 0.037,
 0.009,
 0.0,
 -0.009,
 -0.006,
 0.02,
 0.016,
 0.023,
 0.034,
 0.051,
 0.05593646063953628,
 0.05593646063953628]
